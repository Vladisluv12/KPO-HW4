# Микросервисная система интернет-магазина «Гоzон»

Данный проект представляет собой реализацию отказоустойчивой системы обработки заказов и платежей. Система спроектирована для работы в условиях высоких нагрузок и обеспечивает строгие гарантии обработки данных.

## Архитектура системы

Проект реализован с использованием микросервисной архитектуры и включает в себя следующие компоненты:

**API Gateway (Nginx):** Единая точка входа (порт 8080), отвечающая за маршрутизацию запросов и обработку CORS.

**Orders Service:** Сервис управления заказами. Отвечает за создание заказов и отслеживание их жизненного цикла.

**Payments Service:** Сервис управления кошельками пользователей. Отвечает за баланс, пополнение и списание средств.

**Message Broker (RabbitMQ):** Обеспечивает асинхронную связь между сервисами с гарантией доставки.

**Databases (PostgreSQL):** Каждый сервис использует собственную изолированную базу данных для обеспечения автономности.

**Frontend:** Веб-приложение для взаимодействия с пользователем.

### Иcпользованные паттерны:

Надежность и консистентность данных

**Exactly-once Processing:** Реализована семантика "эффективно ровно один раз" при списании средств за заказ. Даже при дублировании сообщений в очереди, баланс пользователя изменяется корректно благодаря идемпотентной логике.

**Transactional Outbox/Inbox:**

Order Service: Использует Transactional Outbox для атомарного сохранения заказа и задачи на оплату и Transactional Inbox для подтверждения оплаты заказа.

Payments Service: Применяет Transactional Inbox для приема задач и Outbox для отправки уведомлений о статусе оплаты обратно в Order Service.

### Асинхронный сценарий создания заказа

Реализован ключевой процесс «Создание заказа —> Автооплата»:

Пользователь создает заказ (статус NEW).

Order Service через RabbitMQ отправляет задачу в Payments Service.

Payments Service проверяет наличие счета и баланс.

При успехе статус заказа меняется на FINISHED, при ошибке — на CANCELLED.

### Cтек и Frontend

Frontend: Реализован как отдельный Docker-контейнер, взаимодействующий с бэкендом через REST API.

### Запуск проекта

Система полностью контейнеризирована и запускается одной командой:

```bash
docker-compose up --build
```

## Доступные интерфейсы

Frontend: <http://localhost:3000>

API Gateway: <http://localhost:8080>

RabbitMQ Management: <http://localhost:15672> (user/password: user/password)

### API Документация

Полная спецификация API представлена в файле full-openapi.yaml. Основные эндпоинты:

#### Платежи (/payments/)

POST /create/{user_id} — Создание счета.

POST /add/{bill_id} — Пополнение баланса.

GET /balance/{bill_id} — Проверка остатка.

#### Заказы (/orders/)

POST /create/{user_id} — Создание заказа (запускает асинхронную оплату).

GET /orders/{user_id} — История заказов.

GET /status/{order_id} — Текущий статус.
